var Slimbox=(function(){var k=window,z=Browser.Engine.trident4,G,l,m=-1,A,I,i,H,K,x,E,y={},F=new Image(),t=new Image(),p,M,n,C,r,h,o,d,a,v,J,q,g,e;k.addEvent("domready",function(){$(document.body).adopt($$(p=new Element("div",{id:"lbOverlay",events:{click:f}}),M=new Element("div",{id:"lbCenter"}),o=new Element("div",{id:"lbBottomContainer"})).setStyle("display","none"));n=new Element("div",{id:"lbImage"}).injectInside(M).adopt(C=new Element("div",{styles:{position:"relative"}}).adopt(r=new Element("a",{id:"lbPrevLink",href:"#",events:{click:c}}),h=new Element("a",{id:"lbNextLink",href:"#",events:{click:j}})));d=new Element("div",{id:"lbBottom"}).injectInside(o).adopt(new Element("a",{id:"lbCloseLink",href:"#",events:{click:f}}),a=new Element("div",{id:"lbCaption"}),v=new Element("div",{id:"lbNumber"}),new Element("div",{styles:{clear:"both"}}))});function L(){var N=k.getScroll(),O=k.getSize();$$(M,o).setStyle("left",N.x+(O.x/2));if(H){p.setStyles({left:N.x,top:N.y,width:O.x,height:O.y})}}function w(N){["object",z?"select":"embed"].forEach(function(P){Array.forEach(document.getElementsByTagName(P),function(Q){if(N){Q._slimbox=Q.style.visibility}Q.style.visibility=N?"hidden":Q._slimbox})});p.style.display=N?"":"none";var O=N?"addEvent":"removeEvent";k[O]("scroll",L)[O]("resize",L);document[O]("keydown",B)}function B(O){var N=O.code;return G.closeKeys.contains(N)?f():G.nextKeys.contains(N)?j():G.previousKeys.contains(N)?c():false}function c(){return b(I)}function j(){return b(i)}function b(N){if(N>=0){m=N;A=l[N][0];I=(m||(G.loop?l.length:0))-1;i=((m+1)%l.length)||(G.loop?0:-1);D();M.className="lbLoading";y=new Image();y.onload=u;y.src=A}return false}function u(){M.className="";g.set(0);n.setStyles({backgroundImage:"url("+A+")",display:""});C.setStyle("width",y.width);$$(C,r,h).setStyle("height",y.height);a.set("html",l[m][1]||"");v.set("html",(((l.length>1)&&G.counterText)||"").replace(/{x}/,m+1).replace(/{y}/,l.length));if(I>=0){F.src=l[I][0]}if(i>=0){t.src=l[i][0]}x=n.offsetWidth;E=n.offsetHeight;var O=Math.max(0,K-(E/2)),P=0,N;if(M.offsetHeight!=E){P=q.start({height:E,top:O})}if(M.offsetWidth!=x){P=q.start({width:x,marginLeft:-x/2})}N=function(){o.setStyles({width:x,top:O+E,marginLeft:-x/2,visibility:"hidden",display:""});g.start(1)};if(P){q.chain(N)}else{N()}}function s(){if(I>=0){r.style.display=""}if(i>=0){h.style.display=""}e.set(-d.offsetHeight).start(0);o.style.visibility=""}function D(){y.onload=$empty;y.src=F.src=t.src=A;q.cancel();g.cancel();e.cancel();$$(r,h,n,o).setStyle("display","none")}function f(){if(m>=0){D();m=I=i=-1;M.style.display="none";J.cancel().chain(w).start(0)}return false}Element.implement({slimbox:function(N,O){$$(this).slimbox(N,O);return this}});Elements.implement({slimbox:function(P,O,N){O=O||function(R){return[R.href,R.title]};N=N||function(){return true};var Q=this;Q.removeEvents("click").addEvent("click",function(){var R=Q.filter(N,this);return Slimbox.open(R.map(O),R.indexOf(this),P)});return Q}});return{open:function(O,N,P){G=$extend({loop:false,overlayOpacity:0.8,overlayFadeDuration:400,resizeDuration:400,resizeTransition:false,initialWidth:250,initialHeight:250,imageFadeDuration:400,captionAnimationDuration:400,counterText:"Image {x} of {y}",closeKeys:[27,88,67],previousKeys:[37,80],nextKeys:[39,78]},P||{});J=new Fx.Tween(p,{property:"opacity",duration:G.overlayFadeDuration});q=new Fx.Morph(M,$extend({duration:G.resizeDuration,link:"chain"},G.resizeTransition?{transition:G.resizeTransition}:{}));g=new Fx.Tween(n,{property:"opacity",duration:G.imageFadeDuration,onComplete:s});e=new Fx.Tween(d,{property:"margin-top",duration:G.captionAnimationDuration});if(typeof O=="string"){O=[[O,N]];N=0}K=k.getScrollTop()+(k.getHeight()/2);x=G.initialWidth;E=G.initialHeight;M.setStyles({top:Math.max(0,K-(E/2)),width:x,height:E,marginLeft:-x/2,display:""});H=z||(p.currentStyle&&(p.currentStyle.position!="fixed"));if(H){p.style.position="absolute"}J.set(0).start(G.overlayOpacity);L();w(1);l=O;G.loop=G.loop&&(l.length>1);return b(N)}}})();Slimbox.scanPage=function(){$$("a").filter(function(b){return b.rel&&b.rel.test(/^lightbox/i)}).slimbox({},null,function(b){return(this==b)||((this.rel.length>8)&&(this.rel==b.rel))})};if(!/android|iphone|ipod|series60|symbian|windows ce|blackberry/i.test(navigator.userAgent)){window.addEvent("domready",Slimbox.scanPage)};